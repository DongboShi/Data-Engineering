<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 5 章 网络数据采集 | 数据工程讲义：经济学分册</title>
  <meta name="description" content="一个简单的中文书示例。" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="第 5 章 网络数据采集 | 数据工程讲义：经济学分册" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="一个简单的中文书示例。" />
  <meta name="github-repo" content="yihui/bookdown-chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 5 章 网络数据采集 | 数据工程讲义：经济学分册" />
  
  <meta name="twitter:description" content="一个简单的中文书示例。" />
  

<meta name="author" content="史冬波 续本达" />


<meta name="date" content="2020-09-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rw.html"/>
<link rel="next" href="md.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据工程讲义</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#致谢"><i class="fa fa-check"></i>致谢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> 写在前面</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#为什么写本书"><i class="fa fa-check"></i><b>1.1</b> 为什么写本书</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#如何使用本书"><i class="fa fa-check"></i><b>1.2</b> 如何使用本书</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="flow.html"><a href="flow.html"><i class="fa fa-check"></i><b>2</b> 重塑经济学研究的流程</a>
<ul>
<li class="chapter" data-level="2.1" data-path="flow.html"><a href="flow.html#人工智能时代的社会科学研究机遇与挑战"><i class="fa fa-check"></i><b>2.1</b> 人工智能时代的社会科学研究：机遇与挑战</a></li>
<li class="chapter" data-level="2.2" data-path="flow.html"><a href="flow.html#数据工程与数据科学"><i class="fa fa-check"></i><b>2.2</b> 数据工程与数据科学</a></li>
<li class="chapter" data-level="2.3" data-path="flow.html"><a href="flow.html#数据工程的四大原则"><i class="fa fa-check"></i><b>2.3</b> 数据工程的四大原则</a></li>
<li class="chapter" data-level="2.4" data-path="flow.html"><a href="flow.html#数据处理的灵魂数据流"><i class="fa fa-check"></i><b>2.4</b> 数据处理的灵魂：数据流</a></li>
<li class="chapter" data-level="2.5" data-path="flow.html"><a href="flow.html#数据处理的钥匙数据结构"><i class="fa fa-check"></i><b>2.5</b> 数据处理的钥匙：数据结构</a></li>
<li class="chapter" data-level="2.6" data-path="flow.html"><a href="flow.html#数据工程师的工具箱"><i class="fa fa-check"></i><b>2.6</b> 数据工程师的工具箱</a></li>
<li class="chapter" data-level="2.7" data-path="flow.html"><a href="flow.html#数据工程师的一天"><i class="fa fa-check"></i><b>2.7</b> 数据工程师的一天</a></li>
<li class="chapter" data-level="2.8" data-path="flow.html"><a href="flow.html#数据工程data-engineering"><i class="fa fa-check"></i><b>2.8</b> 数据工程(Data Engineering)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="flow.html"><a href="flow.html#flow"><i class="fa fa-check"></i><b>3</b> R编程基础</a>
<ul>
<li class="chapter" data-level="3.1" data-path="flow.html"><a href="flow.html#r对文件和路径的相关操作"><i class="fa fa-check"></i><b>3.1</b> R对文件和路径的相关操作</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="flow.html"><a href="flow.html#路径操作"><i class="fa fa-check"></i><b>3.1.1</b> 路径操作</a></li>
<li class="chapter" data-level="3.1.2" data-path="flow.html"><a href="flow.html#文件操作"><i class="fa fa-check"></i><b>3.1.2</b> 文件操作</a></li>
<li class="chapter" data-level="3.1.3" data-path="flow.html"><a href="flow.html#特殊路径"><i class="fa fa-check"></i><b>3.1.3</b> 特殊路径</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rw.html"><a href="rw.html"><i class="fa fa-check"></i><b>4</b> 数据读写</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rw.html"><a href="rw.html#数据文件类型"><i class="fa fa-check"></i><b>4.1</b> 数据文件类型</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="rw.html"><a href="rw.html#hdf5"><i class="fa fa-check"></i><b>4.1.1</b> HDF5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="web.html"><a href="web.html"><i class="fa fa-check"></i><b>5</b> 网络数据采集</a>
<ul>
<li class="chapter" data-level="5.1" data-path="web.html"><a href="web.html#网络数据格式"><i class="fa fa-check"></i><b>5.1</b> 网络数据格式</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="web.html"><a href="web.html#csv"><i class="fa fa-check"></i><b>5.1.1</b> CSV</a></li>
<li class="chapter" data-level="5.1.2" data-path="web.html"><a href="web.html#xml"><i class="fa fa-check"></i><b>5.1.2</b> XML</a></li>
<li class="chapter" data-level="5.1.3" data-path="web.html"><a href="web.html#json"><i class="fa fa-check"></i><b>5.1.3</b> JSON</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="web.html"><a href="web.html#html"><i class="fa fa-check"></i><b>5.2</b> HTML</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="web.html"><a href="web.html#html的基本语法"><i class="fa fa-check"></i><b>5.2.1</b> HTML的基本语法</a></li>
<li class="chapter" data-level="5.2.2" data-path="web.html"><a href="web.html#常见html标签"><i class="fa fa-check"></i><b>5.2.2</b> 常见HTML标签</a></li>
<li class="chapter" data-level="5.2.3" data-path="web.html"><a href="web.html#dom树形数据结构"><i class="fa fa-check"></i><b>5.2.3</b> DOM树形数据结构</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="web.html"><a href="web.html#css"><i class="fa fa-check"></i><b>5.3</b> CSS</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="web.html"><a href="web.html#css的基本语法"><i class="fa fa-check"></i><b>5.3.1</b> CSS的基本语法</a></li>
<li class="chapter" data-level="5.3.2" data-path="web.html"><a href="web.html#id选择器"><i class="fa fa-check"></i><b>5.3.2</b> id选择器</a></li>
<li class="chapter" data-level="5.3.3" data-path="web.html"><a href="web.html#类选择器"><i class="fa fa-check"></i><b>5.3.3</b> 类选择器</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="web.html"><a href="web.html#javascript"><i class="fa fa-check"></i><b>5.4</b> JavaScript</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="web.html"><a href="web.html#javascript案例"><i class="fa fa-check"></i><b>5.4.1</b> JavaScript案例</a></li>
<li class="chapter" data-level="5.4.2" data-path="web.html"><a href="web.html#javascript的基本语法"><i class="fa fa-check"></i><b>5.4.2</b> JavaScript的基本语法</a></li>
<li class="chapter" data-level="5.4.3" data-path="web.html"><a href="web.html#ajax"><i class="fa fa-check"></i><b>5.4.3</b> AJAX</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="web.html"><a href="web.html#开发者工具"><i class="fa fa-check"></i><b>5.5</b> 开发者工具</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="web.html"><a href="web.html#打开开发者工具"><i class="fa fa-check"></i><b>5.5.1</b> 打开开发者工具</a></li>
<li class="chapter" data-level="5.5.2" data-path="web.html"><a href="web.html#查看器与样式"><i class="fa fa-check"></i><b>5.5.2</b> 查看器与样式</a></li>
<li class="chapter" data-level="5.5.3" data-path="web.html"><a href="web.html#其他功能"><i class="fa fa-check"></i><b>5.5.3</b> 其他功能</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="web.html"><a href="web.html#xpath"><i class="fa fa-check"></i><b>5.6</b> Xpath</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="web.html"><a href="web.html#基本查询"><i class="fa fa-check"></i><b>5.6.1</b> 基本查询</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="web.html"><a href="web.html#http"><i class="fa fa-check"></i><b>5.7</b> HTTP</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="web.html"><a href="web.html#http常见方法"><i class="fa fa-check"></i><b>5.7.1</b> HTTP常见方法</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="web.html"><a href="web.html#静态爬虫"><i class="fa fa-check"></i><b>5.8</b> 静态爬虫</a></li>
<li class="chapter" data-level="5.9" data-path="web.html"><a href="web.html#使用rselenium的动态爬虫"><i class="fa fa-check"></i><b>5.9</b> 使用RSelenium的动态爬虫</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="web.html"><a href="web.html#rselenium简介与安装"><i class="fa fa-check"></i><b>5.9.1</b> RSelenium简介与安装</a></li>
<li class="chapter" data-level="5.9.2" data-path="web.html"><a href="web.html#安装docker"><i class="fa fa-check"></i><b>5.9.2</b> 安装Docker</a></li>
<li class="chapter" data-level="5.9.3" data-path="web.html"><a href="web.html#rselenum语法"><i class="fa fa-check"></i><b>5.9.3</b> RSelenum语法</a></li>
<li class="chapter" data-level="5.9.4" data-path="web.html"><a href="web.html#案例1在链家搜索并获取相关信息"><i class="fa fa-check"></i><b>5.9.4</b> 案例1:在链家搜索并获取相关信息</a></li>
<li class="chapter" data-level="5.9.5" data-path="web.html"><a href="web.html#案例2登录豆瓣"><i class="fa fa-check"></i><b>5.9.5</b> 案例2:登录豆瓣</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="md.html"><a href="md.html"><i class="fa fa-check"></i><b>6</b> 文学式编程</a>
<ul>
<li class="chapter" data-level="6.1" data-path="md.html"><a href="md.html#什么是文学式编程"><i class="fa fa-check"></i><b>6.1</b> 什么是文学式编程</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="make.html"><a href="make.html"><i class="fa fa-check"></i><b>7</b> GUN Make</a>
<ul>
<li class="chapter" data-level="7.1" data-path="make.html"><a href="make.html#使用make的必要性"><i class="fa fa-check"></i><b>7.1</b> 使用Make的必要性</a></li>
<li class="chapter" data-level="7.2" data-path="make.html"><a href="make.html#make安装"><i class="fa fa-check"></i><b>7.2</b> Make安装</a></li>
<li class="chapter" data-level="7.3" data-path="make.html"><a href="make.html#快速上手make"><i class="fa fa-check"></i><b>7.3</b> 快速上手Make</a></li>
<li class="chapter" data-level="7.4" data-path="make.html"><a href="make.html#make的高级语法"><i class="fa fa-check"></i><b>7.4</b> Make的高级语法</a></li>
<li class="chapter" data-level="7.5" data-path="make.html"><a href="make.html#参考资料"><i class="fa fa-check"></i><b>7.5</b> 参考资料</a></li>
<li class="chapter" data-level="7.6" data-path="make.html"><a href="make.html#including-plots"><i class="fa fa-check"></i><b>7.6</b> Including Plots</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="reg.html"><a href="reg.html"><i class="fa fa-check"></i><b>8</b> 回归</a>
<ul>
<li class="chapter" data-level="8.1" data-path="reg.html"><a href="reg.html#一般线性回归"><i class="fa fa-check"></i><b>8.1</b> 一般线性回归</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="reg.html"><a href="reg.html#基础模型"><i class="fa fa-check"></i><b>8.1.1</b> 基础模型</a></li>
<li class="chapter" data-level="8.1.2" data-path="reg.html"><a href="reg.html#稳健性标准误"><i class="fa fa-check"></i><b>8.1.2</b> 稳健性标准误</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="reg.html"><a href="reg.html#因果推断的反事实框架"><i class="fa fa-check"></i><b>8.2</b> 因果推断的反事实框架</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="reg.html"><a href="reg.html#定义因果关系"><i class="fa fa-check"></i><b>8.2.1</b> 定义因果关系</a></li>
<li class="chapter" data-level="8.2.2" data-path="reg.html"><a href="reg.html#cef三定理"><i class="fa fa-check"></i><b>8.2.2</b> CEF三定理</a></li>
<li class="chapter" data-level="8.2.3" data-path="reg.html"><a href="reg.html#交互项还是分组回归"><i class="fa fa-check"></i><b>8.2.3</b> 交互项还是分组回归</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="reg.html"><a href="reg.html#匹配"><i class="fa fa-check"></i><b>8.3</b> 匹配</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="reg.html"><a href="reg.html#原理"><i class="fa fa-check"></i><b>8.3.1</b> 原理</a></li>
<li class="chapter" data-level="8.3.2" data-path="reg.html"><a href="reg.html#案例"><i class="fa fa-check"></i><b>8.3.2</b> 案例</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="reg.html"><a href="reg.html#工具变量"><i class="fa fa-check"></i><b>8.4</b> 工具变量</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="reg.html"><a href="reg.html#原理-1"><i class="fa fa-check"></i><b>8.4.1</b> 原理</a></li>
<li class="chapter" data-level="8.4.2" data-path="reg.html"><a href="reg.html#案例-1"><i class="fa fa-check"></i><b>8.4.2</b> 案例</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="reg.html"><a href="reg.html#双重差分"><i class="fa fa-check"></i><b>8.5</b> 双重差分</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="reg.html"><a href="reg.html#原理-2"><i class="fa fa-check"></i><b>8.5.1</b> 原理</a></li>
<li class="chapter" data-level="8.5.2" data-path="reg.html"><a href="reg.html#案例-2"><i class="fa fa-check"></i><b>8.5.2</b> 案例</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="reg.html"><a href="reg.html#断点回归"><i class="fa fa-check"></i><b>8.6</b> 断点回归</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="reg.html"><a href="reg.html#原理-3"><i class="fa fa-check"></i><b>8.6.1</b> 原理</a></li>
<li class="chapter" data-level="8.6.2" data-path="reg.html"><a href="reg.html#案例-3"><i class="fa fa-check"></i><b>8.6.2</b> 案例</a></li>
<li class="chapter" data-level="8.6.3" data-path="reg.html"><a href="reg.html#其他乱七八糟的方法"><i class="fa fa-check"></i><b>8.6.3</b> 其他乱七八糟的方法</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="reg.html"><a href="reg.html#使用stargazer输出表格"><i class="fa fa-check"></i><b>8.7</b> 使用stargazer输出表格</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="reg.html"><a href="reg.html#标准回归表"><i class="fa fa-check"></i><b>8.7.1</b> 标准回归表</a></li>
<li class="chapter" data-level="8.7.2" data-path="reg.html"><a href="reg.html#默认格式"><i class="fa fa-check"></i><b>8.7.2</b> 默认格式</a></li>
<li class="chapter" data-level="8.7.3" data-path="reg.html"><a href="reg.html#表格表头"><i class="fa fa-check"></i><b>8.7.3</b> 表格表头</a></li>
<li class="chapter" data-level="8.7.4" data-path="reg.html"><a href="reg.html#表格正文"><i class="fa fa-check"></i><b>8.7.4</b> 表格正文</a></li>
<li class="chapter" data-level="8.7.5" data-path="reg.html"><a href="reg.html#添加变量信息"><i class="fa fa-check"></i><b>8.7.5</b> 添加变量信息</a></li>
<li class="chapter" data-level="8.7.6" data-path="reg.html"><a href="reg.html#选择统计量"><i class="fa fa-check"></i><b>8.7.6</b> 选择统计量</a></li>
<li class="chapter" data-level="8.7.7" data-path="reg.html"><a href="reg.html#表格注释"><i class="fa fa-check"></i><b>8.7.7</b> 表格注释</a></li>
<li class="chapter" data-level="8.7.8" data-path="reg.html"><a href="reg.html#整体布局"><i class="fa fa-check"></i><b>8.7.8</b> 整体布局</a></li>
<li class="chapter" data-level="8.7.9" data-path="reg.html"><a href="reg.html#其他"><i class="fa fa-check"></i><b>8.7.9</b> 其他</a></li>
<li class="chapter" data-level="8.7.10" data-path="reg.html"><a href="reg.html#描述性统计表"><i class="fa fa-check"></i><b>8.7.10</b> 描述性统计表</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="reg.html"><a href="reg.html#回归结果的可视化"><i class="fa fa-check"></i><b>8.8</b> 回归结果的可视化</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="reg.html"><a href="reg.html#使用ggcoefstats可视化回归结果"><i class="fa fa-check"></i><b>8.8.1</b> 使用ggcoefstats可视化回归结果</a></li>
<li class="chapter" data-level="8.8.2" data-path="reg.html"><a href="reg.html#使用"><i class="fa fa-check"></i><b>8.8.2</b> 使用</a></li>
<li class="chapter" data-level="8.8.3" data-path="reg.html"><a href="reg.html#双重差分模型的可视化"><i class="fa fa-check"></i><b>8.8.3</b> 双重差分模型的可视化</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="sound.html"><a href="sound.html"><i class="fa fa-check"></i><b>A</b> 余音绕梁</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据工程讲义：经济学分册</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="web" class="section level1" number="5">
<h1><span class="header-section-number">第 5 章</span> 网络数据采集</h1>
<blockquote>
<p>就是为了这点儿醋，我才包的这顿饺子。
<em>—邪不压正</em></p>
</blockquote>
<p>这一章我们将介绍如何通过R采集网络数据。互联网每一秒都在产生数据，网络已经成为经济学研究以及很多数据公司的重要数据来源，因此学习网络数据采集就非常有必要。本章的第一节我们将介绍网络上数据传输的主要格式；第二节将介绍超文本链接语言的基本语法，这是采集网络数据的基础；第三节中，我们将介绍一种针对HTML的特定查询语言-Xpath，它将帮助我们从HTML中快速找到我们需要的信息；第四节我们将补充介绍CSS（层叠样式表）的基础知识，一方面CSS可以提到Xpath帮助我们解析网页信息，另一方面，CSS的基础知识将在文学式编程中起到四两拨千斤的作用；第五节我们将介绍HTTP通信的基本方式；第六节中我们介绍一个静态网页爬虫的案例；第七节中我们将介绍如何使用Selenuim框架完成动态网页爬虫；第八节（如果能完成的话）我们将使用HTTP基本通信方法实现动态网页爬虫</p>
<div id="网络数据格式" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> 网络数据格式</h2>
<p>正如我们在最前面介绍的，数据不仅仅是数据工程分析的对象，更是数据工程不同部分之间衔接的接口，数据读写是数据分析的基础。而网络通信说到底也是数据的交流过程。</p>
<p>按照数据的使用方式，我们可以将数据进一步分为通用数据与非通用数据，前者不限于特定的编程工具，在程序世界中扮演着“通用货币”的角色，是可以跨语言跨工具使用的标准数据，例如txt,csv,xml,json, hdf5等；后者则是特定语言使用的数据，在一定程度上也可以跨语言使用，但是跨语言使用时经常伴随有信息的错误与损失，常见的非通用数据有dta(Stata),xls(MS Excel),spv(SPSS), RData(R)等。RStudio在使用非通用数据时，可以从<code>Import Dataset</code>下拉菜单中选择相应的选项。在网络通信中，通用数据是主角。</p>
<div id="csv" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> CSV</h3>
<p>CSV(Comma-Separated Values)逗号分隔值文本数据，以纯文本形式存储表格数据（数字和文本）。纯文本意味着该文件是一个字符序列，不含必须像二进制数字那样被解读的数据。CSV文件由任意数目的记录组成，记录间以某种换行符分隔；每条记录由字段组成，字段间的分隔符是其它字符或字符串，最常见的是逗号或制表符(tsv)。
CSV的优势在于可以用MS Excel直接编辑，读写简便，跨平台使用方便，其最大劣势为以表结构为基础，灵活性较差，尤其是数据结构比较复杂时，CSV的效率会变得很差。</p>
</div>
<div id="xml" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> XML</h3>
<p>XML(Extensible Markup Language),-可扩展标记语言-是专门设计用来传输数据的标记语言。R中我们使用<strong>XML</strong>包读入XML数据，</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="web.html#cb1-1"></a><span class="kw">library</span>(XML)</span>
<span id="cb1-2"><a href="web.html#cb1-2"></a>math &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(<span class="st">&quot;math_sample.xml&quot;</span>)</span>
<span id="cb1-3"><a href="web.html#cb1-3"></a>math</span></code></pre></div>
<pre><code>## &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
## &lt;publications dataset=&quot;scad-zbmath-01-limited-access&quot;&gt;
##   &lt;publication id=&quot;zbmath:0790.73063&quot;&gt;
##     &lt;title&gt;Torsional vibrations of nonhomogeneous magnetostrictive elastic circular cylinder&lt;/title&gt;
##     &lt;venue&gt;Int. J. Math. Math. Sci. 17, No.1, 181-185 (1994).&lt;/venue&gt;
##     &lt;year&gt;1994&lt;/year&gt;
##     &lt;classification&gt;74F15 74H45&lt;/classification&gt;
##     &lt;keywords&gt;circumferential magnetic field; axial current; longitudinal magnetic field; frequency equation; displacement; stress&lt;/keywords&gt;
##     &lt;abstract&gt;This paper is concerned with the torsional vibrations of a nonhomogeneous magnetostrictive elastic cylinder. The cylinder is subjected to the action of a circumferential magnetic field produced by an axial current of constant density, and the deformation of a magnetostrictive cylinder is produced by a constant longitudinal magnetic field. The frequency equation is determined, and the displacement and stress components are numerically calculated with graphical presentations.&lt;/abstract&gt;
##     &lt;authors&gt;
##       &lt;author name=&quot;Debnath, Lokenath&quot; shortname=&quot;Debnath, L.&quot; id=&quot;debnath.lokenath&quot;/&gt;
##     &lt;/authors&gt;
##   &lt;/publication&gt;
##   &lt;publication id=&quot;zbmath:0805.73022&quot;&gt;
##     &lt;title&gt;Torsional wave propagation in an orthotropic magneto-elastic hollow circular cylinder&lt;/title&gt;
##     &lt;venue&gt;Appl. Math. Comput. 63, No.2-3, 281-293 (1994).&lt;/venue&gt;
##     &lt;year&gt;1994&lt;/year&gt;
##     &lt;classification&gt;74J10 74F15&lt;/classification&gt;
##     &lt;keywords&gt;extrema; characteristic numbers; phase velocities; first five modes&lt;/keywords&gt;
##     &lt;authors&gt;
##       &lt;author name=&quot;Abd-alla, Abo-el-nour N.&quot; shortname=&quot;Abd-alla, A.&quot; id=&quot;abd-alla.abo-el-nour-n&quot;/&gt;
##     &lt;/authors&gt;
##   &lt;/publication&gt;
## &lt;/publications&gt;
## </code></pre>
<p>标准的XML可以分为标记（Markup）与内容（Content）两类。标记通常以<code>&lt;</code>开头，以<code>/&gt;</code>结尾，在上面的例子中，<code>publications</code>以及<code>publication</code>都是标记。</p>
<p>标记也称为标签Tag，是规定XML文件结构的部分，是数据的结构。</p>
<p>内容又称为元素Element，是标签“标记”的部分，是数据的值。上面的例子中<code>Torsional vibrations of nonhomogeneous magnetostrictive elastic circular cylinder</code>便是标记<code>title</code>的值。</p>
<p>每一个标签可以拥有若干属性Attribute，属性以name=value的形式出现。每个元素中，一个属性最多出现一次，一个属性只能有一个值。例如第一个<code>publication</code>标记拥有一个属性id，取值为zbmath:0790.73063。</p>
<p>从数据结构上来说XML是树形结构，其优点在于跨平台表现优异，可以传输结构复杂的数据。因此，经常被用作通用数据标准。但是细心的读者很容易发现XML的劣势，大部分标签名都重复出现了两次。另外，仅仅从数据传输而不是数据可视化的角度来说，属性本质上也可以用标签+内容的方式来表达，而不需要单独设置。这都使得XML在传输数据方面，显得比较“笨重”，效率还有提升的空间。</p>
</div>
<div id="json" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> JSON</h3>
<p>JASON(JavaScript Object Notation,JavaScript)-Java对象表示法-是由道格拉斯·克罗克福特构想和设计、轻量级的数据交换语言，该语言以易于让人阅读的文字为基础，用来传输由属性值或者序列性的值组成的数据对象。尽管JSON起初是为JavaScript设计的，但如今早已发展成为独立于特定语言之外的通用数据格式。</p>
<p>R中可以使用<strong>jsonlite</strong>读写JSON文件，读入数据成为一个list</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="web.html#cb3-1"></a><span class="kw">library</span>(jsonlite)</span>
<span id="cb3-2"><a href="web.html#cb3-2"></a>leadboard &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;leaderboards.json&quot;</span>,<span class="dt">flatten =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="leaderboards.png" width="80%" /></p>
<p>JSON由对象object与数组组成。对象(object)是一个对象包含一系列非排序的名称／值对(pair)，一个对象以<code>{</code>开始，并以<code>}</code>结束。每个名称／值对之间使用<code>:</code>分割。上面的例子中<code>"version":3</code>就是一个对象，其名称是version，value是3。</p>
<p>数组(array)：一个数组是一个值(value)的集合，一个数组以<code>[</code>开始，并以<code>]</code>结束。数组成员之间使用<code>,</code>分割。上面例子中<code>"ordinals"</code>对应的值便是一个数组。</p>
<p>JSON与XML最大的不同在于XML是一个完整的标记语言，而JSON不是。XML利用标记语言的特性提供了绝佳的延展性（如XPath），在数据存储，扩展及高级检索方面具备对JSON的优势，而JSON则由于比XML更加小巧，以及浏览器的内建快速解析支持，使得其更适用于网络数据传输领域。</p>
</div>
</div>
<div id="html" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> HTML</h2>
<p>由于我们的任务是从网页上采集数据，所以非常有必要学习网页设计的基本知识。网页设计有三大件：HTML、CSS 和 Javascript，相当于80年代的冰箱、彩电、洗衣机三大件。HTML是一种标记语言，用来设计网页的内容以及内容的层次结构；CSS规定网页展示的方式，例如颜色、字体和布局；Javascript是一种脚本语言，用来实现动态内容。 MDN (Mozilla Developer Network), w3schools.com提供了丰富且详细的教程与案例。不过要友情提示一下，W3school的教程简洁明了，还有可以运行的案例，经常一学起来就会停不下来，挺耽误正事儿的，一不小心容易把自己学成一个前端工程师。我们的目的并不是成为一名优秀的前端工程师，因此本书中并不会事无巨细地介绍相关语言，仅仅是为大家后续学习提供一个接口。</p>
<p>HTML(Hyper Text Markup Language)，超文本标记语言不是一种编程语言，而是一种标记语言，使用一整套标签规则来描述网页的信息。这里的信息既包括网页需要承载的内容，也包括如何展示这些内容的设计。实际上，我们打开浏览器之后看到的内容的源码都是HTML。</p>
<div id="html的基本语法" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> HTML的基本语法</h3>
<p>标签与内容组合起来构成了HTML的组成元素。标签(tag)是有尖括号括起来的关键词，例如，<code>&lt;tb&gt;</code>。除了极少数情况(例如表示换行的<code>&lt;br&gt;</code>)外，标签通常是成对出现的，一个开放标签与一个闭合标签。例如<code>&lt;div&gt;与&lt;/div&gt;</code>，闭合标签多了一个<code>/</code>。</p>
<p>HTML标签可以拥有属性，属性出现在开放标签内，以name=“value”的形式出现。注意这里的<code>""</code>不可以省略。另外属性值对于大小写不敏感。</p>
<p><em>加入google的例子作为说明</em></p>
</div>
<div id="常见html标签" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> 常见HTML标签</h3>
<p><strong>锚标签</strong><code>&lt;a&gt;&lt;/a&gt;</code>允许HTML网页可以链接到其他文档，从而把HTML从单纯的标记语言编程超文本标记语言。</p>
<p>第一种用法是使用网页地址作为绝对路径的锚标签：</p>
<pre><code>&lt;a href = &quot;https://www.w3school.com.cn/html/index.asp&quot;&gt;点击此处打开W3school &lt;/a&gt;</code></pre>
<p><a href = "https://www.w3school.com.cn/html/index.asp">点击此处打开W3school </a></p>
<p>第二种用法是在文档中设定锚定点，并在后续文档中使用，实现文件内链接：</p>
<pre><code>设置一个引用点并使用
&lt;a id =&quot;top&quot;&gt;我是引用点&lt;/a&gt;
使用引用点
&lt;a href = &quot;#top&quot;&gt;跳到引用点&lt;/a&gt;</code></pre>
<p>设置一个引用点并使用</p>
<p><a id ="top">我是引用点</a></p>
<p>使用引用点</p>
<p><a href = "#top">跳到引用点</a></p>
<p>上述两种标签可以联合使用。</p>
<p><strong>元数据标签</strong><code>&lt;meta&gt;</code>是一个无需闭合的标签，定义了HTML网页的元信息，例如作者、编码方式等。</p>
<pre class="{,eval=flase}"><code>&lt;meta name = &#39;keywords&quot; content = &quot;Data Engineering&quot;&gt;</code></pre>
<p><strong>外部引用标签</strong><code>&lt;ref&gt;&lt;/ref&gt;</code>用于引入信息与外部文件，在head元素内部使用，是空元素，所有信息都在属性内提供</p>
<pre><code>指定使用的样式表
&lt;link rel = &quot;stylesheet&quot; href=&quot;htmlresources/awesomestyle.csss&quot; type = &quot;text/csss&quot; /&gt;</code></pre>
<pre><code>使用指定网站的相关图标
&lt;link rel = &quot;shortcut icon&quot; href = &quot;https://www.r-project.org/logo/Rlogo.svg&quot; type = &quot;image/x-icon&quot; /&gt;</code></pre>
<p><strong>强调标签</strong>用于强调特定文本，常见的强调标签有：</p>
<pre><code>&lt;b&gt; 这里是粗体 &lt;/b&gt;
&lt;i&gt; 这里是斜体 &lt;/i&gt;
&lt;strong&gt; 这里是加重 &lt;/strong&gt;
&lt;s&gt; 这里是删除 &lt;/s&gt;</code></pre>
<p><b> 这里是粗体 </b>
<i> 这里是斜体 </i>
<strong> 这里是加重 </strong>
<s> 这里是删除 </s></p>
<p><strong>段落标签</strong><code>&lt;p&gt; &lt;/p&gt;</code> 用于标记其内部内容为一个段落，段落前后均有换行</p>
<pre><code>&lt;p&gt;这里是一个段落&lt;/p&gt;</code></pre>
<p>
这里是一个段落
</p>
<p><strong>列举标签</strong>包括有序列表、无序列表以及自定义列表。有序列表由<code>&lt;ol&gt;</code> 与<code>&lt;li&gt;</code>配合使用，例如：</p>
<pre><code>&lt;ol&gt;
&lt;li&gt;第一项&lt;/li&gt;
&lt;li&gt;第二项&lt;/li&gt;
&lt;/ol&gt;

&lt;dl&gt; 与(&lt;dt&gt;,&lt;dd&gt;) 描述列表</code></pre>
<p>会显示为：</p>
<ol>
<li>
第一项
</li>
<li>
第二项
</li>
</ol>
<p>无序列表由<code>&lt;ul&gt;</code> 与<code>&lt;li&gt;</code>配合使用，例如：</p>
<pre><code>&lt;ol&gt;
&lt;li&gt;这是一个无序列表&lt;/li&gt;
&lt;li&gt;这是另一个无序列表&lt;/li&gt;
&lt;/ol&gt;</code></pre>
<p>会显示为：</p>
<ol>
<li>
这是一个无序列表
</li>
<li>
这是另一个无序列表
</li>
</ol>
<p>自定义列表由<code>&lt;dl&gt;</code>与<code>&lt;dt&gt;</code>、<code>&lt;dd&gt;</code> 配合使用，<code>&lt;dt&gt;</code>后是列表，<code>&lt;dd&gt;</code>是对列表的描述，例如：</p>
<pre><code>&lt;dl&gt;
   &lt;dt&gt;计算机&lt;/dt&gt;
   &lt;dd&gt;用来计算的仪器 ... ...&lt;/dd&gt;
   &lt;dt&gt;显示器&lt;/dt&gt;
   &lt;dd&gt;以视觉方式显示信息的装置 ... ...&lt;/dd&gt;
&lt;/dl&gt;</code></pre>
会显示为：
<dl>
<dt>
计算机
</dt>
<dd>
用来计算的仪器 … …
</dd>
<dt>
显示器
</dt>
<dd>
以视觉方式显示信息的装置 … …
</dd>
</dl>
<p><strong>布局标签</strong>由<code>&lt;div&gt;</code>定义，每一个布局的显示方式可以用层叠样式表CSS配套使用，从而实现内容和布局分开，再次实现<strong>正交分解</strong>。我们下节将介绍CSS。</p>
<p><strong>表格</strong>由<code>&lt;table&gt;</code>标签来定义，同时使用<code>&lt;tr&gt;</code>来标注行，<code>&lt;td&gt;</code>来标注列。例如：</p>
<pre><code>&lt;table border=&quot;1&quot;&gt;
&lt;tr&gt;
&lt;td&gt;row 1, cell 1&lt;/td&gt;
&lt;td&gt;row 1, cell 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;row 2, cell 1&lt;/td&gt;
&lt;td&gt;row 2, cell 2&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;</code></pre>
<table border="1">
<tr>
<td>
row 1, cell 1
</td>
<td>
row 1, cell 2
</td>
</tr>
<tr>
<td>
row 2, cell 1
</td>
<td>
row 2, cell 2
</td>
</tr>
</table>
<p><strong>外部脚本标签</strong><code>&lt;script&gt;</code>用于定义客户端脚本，在HTML中引入javascript脚本。</p>
<p><strong>表单</strong><code>&lt;form&gt;</code>是一类特殊的标签，其作用在于收集用户的输入，根据不同的收集方式，表单可以分为不同的类型。例如，<code>&lt;input type="text"&gt;</code> 定义用于文本输入的单行输入字段。更详细的表单使用方法可以参考W3school。</p>
<pre><code>&lt;form&gt;
 First name:&lt;br&gt;
&lt;input type=&quot;text&quot; name=&quot;firstname&quot;&gt;
&lt;br&gt;
 Last name:&lt;br&gt;
&lt;input type=&quot;text&quot; name=&quot;lastname&quot;&gt;
&lt;/form&gt; </code></pre>
<p>会显示为：</p>
<form>
First name:<br>
<input type="text" name="firstname">
<br>
Last name:<br>
<input type="text" name="lastname">
</form>
</div>
<div id="dom树形数据结构" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> DOM树形数据结构</h3>
<p>网页实际上是标签嵌套标签构成的，从数据结构上来看，标准的HTML都是一个树状结构，这与XML 和JSON是一致的。在R中，可以使用XML包的htmlParse函数将一个储存在向量中的字符串状态的html数据解析成为树状结构。</p>
<p>在采集网络数据之前，我们往往需要先在浏览器中熟悉一下网页的HTML源码。Chrome 浏览器的开发者工具与Firefox的Web开发者工具中查看网页的源代码。</p>
</div>
</div>
<div id="css" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> CSS</h2>
<p>CSS(Cascading Style Sheets)层叠样式表用于规定网页的布局（例如将网页分成几个板块）与风格（例如颜色、字体大小等），从而实现网页设计中的内容与样式的正交分割，从而极大地提升了网页设计的工作效率。熟悉CSS不仅可以在网络数据爬取中使用CSS选择器来解析网页信息，也可以让你对文学式编程中的排版游刃有余。CSS既可以位于HTML的<code>&lt;head&gt;</code>标签内部，也可以储存在一个外部<code>.css</code>文件中，并通过<code>&lt;head&gt;</code>标签内<code>&lt;link rel="stylesheet" href="styles.css"&gt;</code>来调用，其中style.css是CSS文件名称，需要与<code>.html</code>文件放在同一个路径中。</p>
<div id="css的基本语法" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> CSS的基本语法</h3>
<p>CSS规则由两部分构成：选择器与声明，<code>selector {property: value}</code>,其中声明包括“属性:值”对的形式出现，多个声明用分号分割。例如，</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;My CSS experiment&lt;/title&gt;
    &lt;style&gt;
      h5 {
        color: blue;
        background-color: yellow;
        border: 1px solid black;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h5&gt;Hello World!&lt;/h5&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
上述代码中，我们设置了一个h5（五级标题），字体颜色为蓝色，背景颜色为黄色，边框为宽度为1的黑色实线，并且我们将该样式应用于“Hello World”，其现实效果为：
<html>
<head>
<meta charset="utf-8">
<title>
My CSS experiment
</title>
<style>
      h5 {
        color: blue;
        background-color: yellow;
        border: 1px solid black;
      }
    </style>
</head>
<body>
<h5>
Hello World!
</h5>
</body>
</html>
<p>当然我们可以通过内联样式来实现同样的功能，但是我们并不推荐这种写法，因为这种写法没有充分发挥正交性，难以维护。</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;My CSS experiment&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1 style=&quot;color: blue;background-color: yellow;border: 1px solid black;&quot;&gt;Hello World!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
<div id="id选择器" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> id选择器</h3>
<p>id选择器可以为有特定id的HTML元素指定特定的样式，id选择器以<code>#</code>来定义。例如下面的代码中定义了两个id选择器，对应字体分别为红色和绿色，并在后续的html中使用该样式：</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;My CSS experiment&lt;/title&gt;
    &lt;style&gt;
     #red {color:red;}
     #green {color:green;}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p id=&quot;red&quot;&gt;这个段落是红色。&lt;/p&gt;
    &lt;p id=&quot;green&quot;&gt;这个段落是绿色。&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
显示结果为：
<html>
<head>
<meta charset="utf-8">
<title>
My CSS experiment
</title>
<style>
     #red {color:red;}
     #green {color:green;}
    </style>
</head>
<body>
<p id="red">
这个段落是红色。
</p>
<p id="green">
这个段落是绿色。
</p>
</body>
</html>
</div>
<div id="类选择器" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> 类选择器</h3>
<p>类选择器以一个点号定义，在html中通过<code>class=""</code>来使用。在下面的例子中，我们定义了一个居中样式的类选择器，</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;My CSS experiment&lt;/title&gt;
    &lt;style&gt;
     .center {text-align: center}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p class=&quot;center&quot;&gt;这个段落是居中的。&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p><code>.center {text-align: center}</code>定义了居中的样式，并在后续段落中使用，其显示结果为：</p>
<html>
<head>
<meta charset="utf-8">
<title>
My CSS experiment
</title>
<style>
     .center {text-align: center}
    </style>
</head>
<body>
<p class="center">
这个段落是居中的。
</p>
</body>
</html>
<p>当然CSS的内容远远要比我们此处介绍的丰富，网页上的所有样式都是通过CSS设定的，推荐大家在MDN与W3school深入学习。特别需要指出的是，CSS还可以辅助我们从DOM中提取相关信息，虽然本书的技术重点是通过XPath来解析网页，但是我们也会介绍CSS的方法。</p>
</div>
</div>
<div id="javascript" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> JavaScript</h2>
<p>JavaScript 是一种针对网页的脚本编程语言，可以在网页上实现复杂的功能，网页可以从静态网页，变成包括交互式、动画以及滚动播放等功能的动态网页。JavaScript是一个典型的面向对象的编程语言，对于已经掌握本书前面基础知识的读者，自学JS并不是一个很大的挑战。还有个事儿得解释一下，JavaScript并不是Java的衍生品。可以说JavaScript和Java的关系就相当于周杰伦和周杰的关系。</p>
<p>本书的篇幅不允许我们对JavaScript做全面和深入的介绍，这也不是本书的任务。同时，市面上已经有足够多优秀的JavaScript教材，而且W3School和MDN也为我们提供了足够详细的教程。再次提醒读者，在学习JS时候，一定要利用好开发者工具。</p>
<p>本节中，我们参考MDN教程<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>改编了一个案例，来给大家展示JavaScript的基本语法与功能。</p>
<div id="javascript案例" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> JavaScript案例</h3>
<p>通过这段代码，我们可以玩一个名字是黑魔法的猜字游戏，你最多有十次机会猜中一个我们附魔的词汇（如果你是一个聚会高手，或者看过《向往的生活》的话，这个题目肯定难不住你）。在看讲解之前，大家可以先自己玩几盘这个小游戏，看看能否解锁这个游戏的逻辑。
其编译结果为：</p>
<html>
<head>
<title>
黑魔法游戏
</title>
</head>
<body>
<h4>
黑魔法游戏
</h4>
<p>
我刚才附魔了一个词汇，请你发挥你的魔法天赋，看看能否猜中它！你将有10次机会，考验你魔力的时刻到了！
</p>
<div class="form">
<label for="guessField">请猜词：</label><input type="text" id="guessField" class="guessField">
<input type="submit" value="我猜" class="guessSubmit">
</div>
<div class="resultParas">
<p class="guesses">
</p>
<p class="lastResult">
</p>
</div>
<script>
    const guesses = document.querySelector('.guesses');
    const lastResult = document.querySelector('.lastResult');
    const guessSubmit = document.querySelector('.guessSubmit');
    const guessField = document.querySelector('.guessField');
    let guessCount = 1;
    let resetButton;
    let signal = 0 ;
    function checkGuess() {
      let userGuess = guessField.value;
      if (guessCount === 1) {
        guesses.textContent = '上次猜的词：';
      }
      guesses.textContent += userGuess + " ";
      if (signal === 1) {
        lastResult.textContent = '你太聪明了！已经掌握了黑魔法！';
        lastResult.style.backgroundColor = 'green';
        setGameOver(1);
        } else if (guessCount === 10) {
          lastResult.textContent = '!!!很遗憾，你没有得到黑魔法的精髓!!!';
          setGameOver(0);
        } else {
          lastResult.textContent = '你的魔力还不够，请用点子智慧！';
          lastResult.style.backgroundColor = 'red';
          if (userGuess.match("黑") != null) {
            signal = 1;
          }
        }
        guessCount++;
        guessField.value = '';
        guessField.focus();
      }
      guessSubmit.addEventListener('click', checkGuess);
      function setGameOver(x) {
        guessField.disabled = true;
        guessSubmit.disabled = true;
        resetButton = document.createElement('button');
        if (x===1) {
          resetButton.textContent = '再次施展魔法';
        } else {
          resetButton.textContent = '我不死心';
        }
        document.body.appendChild(resetButton);
        resetButton.addEventListener('click', resetGame);
      }
      function resetGame() {
        guessCount = 1;
        signal = 0;
        const resetParas = document.querySelectorAll('.resultParas p');
        for(let i = 0 ; i < resetParas.length ; i++) {
          resetParas[i].textContent = '';
        }
        resetButton.parentNode.removeChild(resetButton);
        guessField.disabled = false;
        guessSubmit.disabled = false;
        guessField.value = '';
        guessField.focus();
        lastResult.style.backgroundColor = 'white';
      }
  </script>
</body>
</html>
<p>该案例的源代码如下：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html &gt;
  &lt;head&gt;
    &lt;meta content=&quot;charset=UTF-8&quot;&gt;
    &lt;title&gt;黑魔法游戏&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;黑魔法游戏&lt;/h1&gt;

    &lt;p&gt;我刚才附魔了一个词汇,请你发挥你的魔法天赋，看看能否猜中它！你将有10次机会，考验你魔力的时刻到了！&lt;/p&gt;
// 定义表单
    &lt;div class=&quot;form&quot;&gt;
      &lt;label for=&quot;guessField&quot;&gt;请猜词：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;guessField&quot; class=&quot;guessField&quot;&gt;
      &lt;input type=&quot;submit&quot; value=&quot;我猜&quot; class=&quot;guessSubmit&quot;&gt;
    &lt;/div&gt;
//可变输出内容
    &lt;div class=&quot;resultParas&quot;&gt;
      &lt;p class=&quot;guesses&quot;&gt;&lt;/p&gt;
      &lt;p class=&quot;lastResult&quot;&gt;&lt;/p&gt;
      &lt;p class=&quot;guessCount&quot;&gt;&lt;/p&gt;
    &lt;/div&gt;
//JavaScript代码块
    &lt;script&gt;
//定义四个常量和三个变量
      const guesses = document.querySelector(&#39;.guesses&#39;); //document.querySelector是一个HTML DOM方法,通过CSS选择器查找HTML中guesses类元素,后面三行功能类似
      const lastResult = document.querySelector(&#39;.lastResult&#39;);
      const guessSubmit = document.querySelector(&#39;.guessSubmit&#39;);
      const guessField = document.querySelector(&#39;.guessField&#39;);
      let guessCount = 1;
      let signal = 0 ;
      let resetButton;
      
      function checkGuess() {
        let userGuess = guessField.value; //声明了一个名为 userGuess 的变量，并将其设置为在文本字段中输入的值
        //下面的代码中是一个条件语句,当guessCount为1时，让 guesses 段落的文本内容等于“上次猜的数：”
        if (guessCount === 1) {
          guesses.textContent = &#39;上次猜的词：&#39;;
        }
        guesses.textContent += userGuess + &quot; &quot;;//将userGuess的值附加到 guesses 段落的末尾，并加上一个空格
        //下面是一个三重条件语句
        if (signal === 1) {
          lastResult.textContent = &#39;你太聪明了！已经掌握了黑魔法！&#39;;//当判断信号为1时，输出文本“你太聪明了！已经掌握了黑魔法！”
          lastResult.style.backgroundColor = &#39;green&#39;;//将文本背景设置为绿色
          setGameOver();\\调用setGameOver函数
        } else if (guessCount === 10) {
          lastResult.textContent = &#39;!!!很遗憾，你没有得到黑魔法的精髓!!!&#39;;//当判断信号不为1且猜词次数已经满10次时，输出文本“!!!很遗憾，你没有得到黑魔法的精髓!!!”
          setGameOver();\\调用setGameOver函数
        } else {
          lastResult.textContent = &#39;你的魔力还不够，请用点子智慧！&#39;;//当判断信号不为1且猜词次数不满10次时，输出文本“你的魔力还不够，请用点子智慧！”
          lastResult.style.backgroundColor = &#39;red&#39;;//将文本背景设置为红色
          if (userGuess.match(&quot;黑&quot;) != null) {
            signal = 1;//同时，当玩家猜的词汇包含“黑”字的时候，将判断信号设为1，这样下次，无论玩家输入什么词汇，都会赢得比赛，这正是黑魔法游戏的精髓
          }
        }
        guessCount++;//guessCount累加1
        guessField.value = &#39;&#39;;//清空guessField值
        guessField.focus();//重新将光标聚焦于guessField
      }

      guessSubmit.addEventListener(&#39;click&#39;, checkGuess);//此处为一个事件监听器。其作用是，当点击Submit按钮时，执行checkGuess函数
//定义游戏结束的函数
      function setGameOver() {
        guessField.disabled = true;
        guessSubmit.disabled = true;//这两行通过将 disable 属性设置为 true 来禁用表单文本输入和按钮
        resetButton = document.createElement(&#39;button&#39;);
        resetButton.textContent = &#39;我不死心&#39;;
        document.body.appendChild(resetButton);
        resetButton.addEventListener(&#39;click&#39;, resetGame);//创建一个新的&lt;button&gt; 元素，设置它的文本为“开始新游戏”，并把它添加到当前 HTML 的底部
      }
      function resetGame() {
        guessCount = 1;//重设猜词次数为1
        signal = 0;//重设判断信号为0
        const resetParas = document.querySelectorAll(&#39;.resultParas p&#39;);//新建一个常数并赋值为包含 &lt;div class=&quot;resultParas&quot;&gt; 内所有段落的变量
        for(let i = 0 ; i &lt; resetParas.length ; i++) {
          resetParas[i].textContent = &#39;&#39;;//通过循环迭代，删除每个段落的文本内容
        }
        resetButton.parentNode.removeChild(resetButton);//从html页面删除resetbotton
        guessField.disabled = false;
        guessSubmit.disabled = false;//这两行通过将 disable 属性设置为 false 来激活表单文本输入和按钮
        guessField.value = &#39;&#39;;//清空guessField值
        guessField.focus();//重新将光标聚焦于guessField
        lastResult.style.backgroundColor = &#39;white&#39;;//设置lastResult文本背景为白色
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
<div id="javascript的基本语法" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> JavaScript的基本语法</h3>
<p>实际上，这段代码中覆盖了JavaScript的常见功能，下面来简述其原理。首先，JavaScript位于<code>&lt;script&gt;</code>标签中间，置于HTML的<code>&lt;body&gt;</code>标签内的最底部。另外，JavaScript还可以置于外部.js文件中，在HTML中通过<code>&lt;script src="sample.js"&gt;&lt;/script&gt;</code>进行调用。</p>
<p>其次，上面代码中，通过<code>let</code>和<code>const</code>创建变量与常量，并通过<code>=</code>对变量进行赋值。在下面的HTML代码中，将两个常量指向网页的段落中的元素。</p>
<pre><code>&lt;p class=&quot;guesses&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;lastResult&quot;&gt;&lt;/p&gt;</code></pre>
<p>同时，使用下列代码，通过HTML表达来获取常量的值。</p>
<pre><code>&lt;label for=&quot;guessField&quot;&gt;请猜词：&lt;/label&gt;
&lt;input type=&quot;text&quot; id=&quot;guessField&quot; class=&quot;guessField&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;我猜&quot; class=&quot;guessSubmit&quot;&gt;</code></pre>
<p><code>let resetButton;</code>设置了一个重置按钮，但是这个功能在我们的书稿中无法正常显示，感兴趣的读者可以将本段代码存成<code>.html</code>文件后用浏览器打开，可以看到全部功能。</p>
<p>第三，<code>document.querySelector</code>与<code>document.createElement</code>代表了HTML DOM方法，用于能够（在HTML元素上）执行的动作，可以通过 JavaScript进行访问与操作，其中<code>document.querySelector</code>是一个CSS类选择器，允许JS关联页面中的对应CSS类元素；<code>document.createElement</code>用于创建一个元素。</p>
<p>第四，我们定义了三个函数，第一个函数<code>checkGuess()</code>用于检查读者输入的词汇是否正确，并根据判断结果与猜词的次数来决定反馈给读者的提示信息；第二个函数<code>setGameOver(x)</code>是一个带有参数的函数，用来决定游戏结束条件与结束时的反馈；第三个函数<code>resetGame()</code>用于重置游戏。JavaScript函数的基本结构为：</p>
<pre><code>function checkGuess() {

}</code></pre>
<p>第五，条件语句。JavaScript以下列结构来构造条件语句：</p>
<pre><code>if () {

}else if(){

}else{

}</code></pre>
<p>第六，事件是浏览器中发生的动作，例如点击按钮、加载页面、播放视频等，我们需要使用事件来调用JavaScript代码。侦听事件发生的结构称为事件监听器（Event Listener），响应事件触发而运行的代码块被称为事件处理器（Event Handler）。例如，<code>guessSubmit.addEventListener('click', checkGuess)</code>是一个事件监听器，<code>addEventListener()</code> 方法包含两个参数：监听事件的类型为<code>click</code>，当事件发生时要执行的代码为<code>checkGuess()</code>。</p>
<p>第七，循环用于重复运行一段代码，直到触发退出条件。其基本结构为：</p>
<pre><code>for(let i = 0//起始值; i &lt; resetParas.length//退出条件; i++//增加器){
resetParas[i].textContent = &#39;&#39;;//执行代码;
}</code></pre>
</div>
<div id="ajax" class="section level3" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> AJAX</h3>
<p>这节待补充完善~</p>
</div>
</div>
<div id="开发者工具" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> 开发者工具</h2>
<p>前文中我们已经多次提到，开发者工具对于熟悉网页设计以及熟练爬取网页信息而言非常重要。我们将以火狐浏览器为例介绍如何熟练使用开发者工具。</p>
<div id="打开开发者工具" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> 打开开发者工具</h3>
<p>Windows系统用户（虽然我不知道为什么你会用windows）可以通过<code>Ctrl + Shift + I</code>，Mac用户可以通过<code>Command + Option + I</code>，来打开浏览器的开发者工具。开发者工具的视图如下
<img src="lianjia.png" width="100%" /></p>
<p>开发者工具也可以从浏览器菜单栏中打开。火狐浏览器的操作路径是：<em>工具 ➢ Web开发者</em>。</p>
</div>
<div id="查看器与样式" class="section level3" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> 查看器与样式</h3>
<p>默认情况下，开发者工具的窗口是<em>查看器</em>和<em>CSS</em>，在查看器中我们可以看到当前网页的HTML源码以及对应的CSS。如果点击查看器左边的箭头，查看器会根据鼠标悬停的位置定位对应的HTML代码段，其效果如下所示：
<img src="lianjia2.png" width="100%" /></p>
<p>选中特定的HTML代码段后鼠标右键单击，此时会出现一个编辑HTML的菜单选项，允许我们操作HTML的内容、节点、以及属性。
<img src="lianjia3.png" width="100%" /></p>
<p>例如，我们可以选择<em>编辑HTML</em>选项，对链家的首页进行了一些修改，这段修改表达了一个青年经济学家的灵魂拷问。
<img src="lianjia4.png" width="100%" /></p>
</div>
<div id="其他功能" class="section level3" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> 其他功能</h3>
<p>查看器旁边的<em>控制台</em>是一个JavaScript编译器，可以编译并调试JavaScript代码，这部分在网络数据采集时候并不经常使用。<em>网络</em>窗口中可以看到打开网页工程中的网络通信结果。<em>样式编辑器</em>窗口可用于修改对应的CSS，我将搜索栏目对应的CSS改为：</p>
<pre><code>.header .header-wrap .search-box-wrap .search-box-con .search .text {
 width:626px;
 padding-left:20px;
 border:0;
 height:55px;
 line-height:55px;
 border-radius:2px;
 font-size:14px;
 color:red
}</code></pre>
<p>于是，我的心声表达地更加强烈了。
<img src="lianjia5.png" width="100%" /></p>
</div>
</div>
<div id="xpath" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Xpath</h2>
<p>XPath 是一种查询语言，用于在HTML和XML文档中定位并提取信息，学习过HTML之后我们知道，相关信息可以储存在HTML的内容或者属性中。XPath是一种特定域语言（Domain-Specific Language,DSL），专用于标记语言文档。</p>
<p>为了写这部分的内容，还得专门制作了一个实验室网页完成</p>
<div id="基本查询" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> 基本查询</h3>
<p>Xpath 基本查询使用“/”分割的节点序列来表达基本路径，例如可以通过</p>
</div>
</div>
<div id="http" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> HTTP</h2>
<p>HTTP(HyperText Transfer Protocal,超文本传输协议)是20世纪80年代，欧洲核子研究中心工作的科学家Tim Berners-Lee, Roy Fielding等人发明的(谁再说基础研究没有价值，就禁止他浏览网站)。HTTP是当前网络客户端和服务器之间进行通信的最常用协议。可以类比于写信的格式。如果把一份HTTP文件比作一封信，每一个标准的HTTP信件都有三个部分组成:</p>
<ul>
<li>起始行</li>
<li>标头</li>
<li>正文</li>
</ul>
<p>HTTP通信分为两步：</p>
<ul>
<li>第一步是客户端向服务器发出请求</li>
<li>第二步是服务器向客户端返回响应</li>
</ul>
<div id="http常见方法" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> HTTP常见方法</h3>
<p>常见HTTP 请求方法包括：</p>
<table>
<thead>
<tr class="header">
<th align="left">方法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">从服务器检索资源</td>
</tr>
<tr class="even">
<td align="left">POST</td>
<td align="left">利用消息正文向服务器发送数据或文件，从服务器检索资源</td>
</tr>
<tr class="odd">
<td align="left">HEAD</td>
<td align="left">和get工作原理类似，但是服务器的响应只有起始行和标头，没有正文</td>
</tr>
<tr class="even">
<td align="left">PUT</td>
<td align="left">把请求消息的正文保存在服务器上</td>
</tr>
<tr class="odd">
<td align="left">DELETE</td>
<td align="left">从服务器删除一个资源</td>
</tr>
<tr class="even">
<td align="left">TRACE</td>
<td align="left">追踪消息到达服务器沿途的路径</td>
</tr>
<tr class="odd">
<td align="left">OPTIONS</td>
<td align="left">返回支持的HTTP方法清单</td>
</tr>
<tr class="even">
<td align="left">CONNECT</td>
<td align="left">建立一个网络连接</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="静态爬虫" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> 静态爬虫</h2>
<p>在掌握以上基础知识之后，我们可以</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="web.html#cb27-1"></a><span class="kw">library</span>(RCurl)</span>
<span id="cb27-2"><a href="web.html#cb27-2"></a><span class="kw">library</span>(XML)</span>
<span id="cb27-3"><a href="web.html#cb27-3"></a><span class="kw">library</span>(stringr)</span>
<span id="cb27-4"><a href="web.html#cb27-4"></a><span class="co"># function</span></span>
<span id="cb27-5"><a href="web.html#cb27-5"></a>gettp &lt;-<span class="st"> </span><span class="cf">function</span>(x,j){</span>
<span id="cb27-6"><a href="web.html#cb27-6"></a>        <span class="kw">return</span>(<span class="kw">str_trim</span>(<span class="kw">unlist</span>(<span class="kw">str_split</span>(x,<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|&quot;</span>))[j]))</span>
<span id="cb27-7"><a href="web.html#cb27-7"></a>}</span>
<span id="cb27-8"><a href="web.html#cb27-8"></a><span class="co"># install.packages(&#39;stringr&#39;)</span></span>
<span id="cb27-9"><a href="web.html#cb27-9"></a>xujiahui &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb27-10"><a href="web.html#cb27-10"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">31</span>){</span>
<span id="cb27-11"><a href="web.html#cb27-11"></a>        <span class="cf">if</span>(i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb27-12"><a href="web.html#cb27-12"></a>                url &lt;-<span class="st"> &quot;https://sh.lianjia.com/ershoufang/rs%E5%BE%90%E5%AE%B6%E6%B1%87/&quot;</span></span>
<span id="cb27-13"><a href="web.html#cb27-13"></a>        }<span class="cf">else</span>{</span>
<span id="cb27-14"><a href="web.html#cb27-14"></a>                url &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://sh.lianjia.com/ershoufang/pg&#39;</span>,i,<span class="st">&#39;rs%E5%BE%90%E5%AE%B6%E6%B1%87/&#39;</span>)</span>
<span id="cb27-15"><a href="web.html#cb27-15"></a>        }</span>
<span id="cb27-16"><a href="web.html#cb27-16"></a>        doc &lt;-<span class="st"> </span><span class="kw">getURL</span>(url)</span>
<span id="cb27-17"><a href="web.html#cb27-17"></a>        parsed_doc &lt;-<span class="st"> </span><span class="kw">htmlParse</span>(doc)</span>
<span id="cb27-18"><a href="web.html#cb27-18"></a>        community &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//a[@data-el=&quot;region&quot;]&#39;</span>,xmlValue)</span>
<span id="cb27-19"><a href="web.html#cb27-19"></a>        totalprice &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;totalPrice&quot;, &quot; &quot; ))]//span&#39;</span>,xmlValue)</span>
<span id="cb27-20"><a href="web.html#cb27-20"></a>        type_all &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;houseInfo&quot;, &quot; &quot; ))]&#39;</span>,xmlValue)</span>
<span id="cb27-21"><a href="web.html#cb27-21"></a>        <span class="co"># for(i in 1:30){</span></span>
<span id="cb27-22"><a href="web.html#cb27-22"></a>        <span class="co">#         print(str_trim(unlist(str_split(type_all[i],pattern = &quot;\\|&quot;))[1]))</span></span>
<span id="cb27-23"><a href="web.html#cb27-23"></a>        <span class="co"># }</span></span>
<span id="cb27-24"><a href="web.html#cb27-24"></a>        type &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">1</span>)))</span>
<span id="cb27-25"><a href="web.html#cb27-25"></a>        size &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">2</span>)))</span>
<span id="cb27-26"><a href="web.html#cb27-26"></a>        year &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">6</span>)))</span>
<span id="cb27-27"><a href="web.html#cb27-27"></a>        avgprice &lt;-<span class="st">  </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;unitPrice&quot;, &quot; &quot; ))]//span&#39;</span>,xmlValue)</span>
<span id="cb27-28"><a href="web.html#cb27-28"></a>        result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(community,totalprice,type,size,year,avgprice)</span>
<span id="cb27-29"><a href="web.html#cb27-29"></a>        xujiahui &lt;-<span class="st"> </span><span class="kw">rbind</span>(xujiahui,result)</span>
<span id="cb27-30"><a href="web.html#cb27-30"></a>        <span class="kw">print</span>(i)</span>
<span id="cb27-31"><a href="web.html#cb27-31"></a>}</span></code></pre></div>
</div>
<div id="使用rselenium的动态爬虫" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> 使用RSelenium的动态爬虫</h2>
<div id="rselenium简介与安装" class="section level3" number="5.9.1">
<h3><span class="header-section-number">5.9.1</span> RSelenium简介与安装</h3>
<p>Selenium是一个跨平台、多语言的浏览器测试工具，可以实现浏览器的自动化测试。RSelenium允许R语言通过Selenuim操纵浏览器，可以帮助我们实现动态爬虫。RSelenium 的目标是让R更容易的连接Selenium Server。RSelenium绑定了R与Selenium Webdriver API。RSelenium可以从CRAN直接安装：</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="web.html#cb28-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;RSelenium&quot;</span>)</span></code></pre></div>
</div>
<div id="安装docker" class="section level3" number="5.9.2">
<h3><span class="header-section-number">5.9.2</span> 安装Docker</h3>
<p>Docker是当前最主流软件容器平台，是用Google公司Go语言开发的基于Linux内核的容器。如果你至少存在一个合作伙伴，那么你大概率遇到过这样的情形，一段在你的电脑上运行良好的代码，放在小伙伴的机器上就出现了各种报错，“这段代码在我机器上没问题啊，我代码肯定没问题呀”。这是因为任何一段代码的运行都是依赖于一个外部环境的，既包括硬件环境，也包括软件环境，例如我们安装和调用的R包，就是一段代码的软件环境，如果小伙伴的机器上并没有安装我们需要的包，代码在运行时候会出错。解决这个问题的最直接的办法是在每一台机器上配置同样的环境，尽管辛苦，但还是可以解决的。但是当使用云端服务器的时候，我们不仅经常切换服务器，甚至有时候都不知道具体用的是哪一个硬件环境，因此，每次都配置一次环境不仅花费时间，设置有时候无法实现。</p>
<p>那么，为什么不把环境和代码封装在一起呢？如果我们规定好这个容器的尺寸和接口，那么我们就不需要每次都在服务器上配置环境了。服务器就好比一个远洋航运公司的轮船，容器就好比是统一尺寸的集装箱，只要客户使用了标准集装箱，无论你集装箱内部装了什么，放在任何一艘轮船上运输都不会有问题。这便是Docker的技术思想，Docker技术的发展真正是实现了代码实现跨平台，跨系统的一致性，从而让开发人员专注于他们擅长的事情，<strong>写出优秀的代码</strong>。这又一次体现了正交分割思想，正交分割思想万岁。</p>
<p>最新版本的RSelenuim通过Docker技术构建一个虚拟的浏览器运行环境，进而模拟浏览器行为。首先下载对应系统的Docker桌面<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>并安装。安装完成之后，运行下面代码为Firefox指定端口：</p>
<pre><code>docker run -d -p 4445:4444 selenium/standalone-firefox:2.53.1</code></pre>
<p>然后，打开Docker的Dashborad，我们能够看到本地所有的镜像：
<img src="docker1.png" width="100%" /></p>
<p>运行Firefox对应的镜像，之后就会看到镜像的运行状况：
<img src="docker2.png" width="100%" /></p>
</div>
<div id="rselenum语法" class="section level3" number="5.9.3">
<h3><span class="header-section-number">5.9.3</span> RSelenum语法</h3>
<p>Relenium中两个最重要的函数为remoteDriver()和webElement(),分别指向Selenium server(可以看做一个浏览器)和页面元素（即各种HTML元素等）。这两个函数创建的对象有很多方法可以用来爬取数据和操作浏览器，读者可以通过<code>help(package="Rselenium")</code>查看完整的函数与使用方法。</p>
<p>remoteDriver()函数常用方法如下：</p>
<table>
<colgroup>
<col width="29%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">方法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>1.打开、浏览与关闭</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">open()</td>
<td align="left">与Selenium server建立连接并打开浏览器</td>
</tr>
<tr class="odd">
<td align="left">navigate(url)</td>
<td align="left">打开url</td>
</tr>
<tr class="even">
<td align="left">close()</td>
<td align="left">关闭当前session</td>
</tr>
<tr class="odd">
<td align="left">quit()</td>
<td align="left">删除session并关闭浏览器</td>
</tr>
<tr class="even">
<td align="left"><strong>2.获取状态信息</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">getStatus()</td>
<td align="left">获取Selenium server的状态</td>
</tr>
<tr class="even">
<td align="left">getCurrentUrl()</td>
<td align="left">获取当前页面的url</td>
</tr>
<tr class="odd">
<td align="left">getTitle()</td>
<td align="left">获取当前页面的标题</td>
</tr>
<tr class="even">
<td align="left">getWindowHandles()</td>
<td align="left">获取所有页面在Selenium中的window handle</td>
</tr>
<tr class="odd">
<td align="left">getPageSource()</td>
<td align="left">获取当前页面的源代码</td>
</tr>
<tr class="even">
<td align="left"><strong>3.发送鼠标与键盘操作</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">mouseMoveToLocation()</td>
<td align="left">将鼠标移动至某一位置，参数x, y代表移动到相对现在鼠标位置的（x,y)距离的位置，参数webElement代表移至某一页面元素的正中位置。一般使用webElement参数更方便。</td>
</tr>
<tr class="even">
<td align="left">click(buttontId = 0)</td>
<td align="left">单击鼠标（buttonId = 0代表左键，1代表中间建，2代表右键）</td>
</tr>
<tr class="odd">
<td align="left">doubleclick(buttonId = 0)</td>
<td align="left">双击鼠标</td>
</tr>
<tr class="even">
<td align="left">sendKeysToActiveElement(sendKeys)</td>
<td align="left">在被激活的页面元素（一般为刚刚被点击的元素）中输入一系列文本或键盘操作。输入内容，必须是list，如果是键盘操作，则前面要注明key= 。 例如：<code>remDr$sendKeysToActiveElement(list("数据分析", key="enter"))</code></td>
</tr>
<tr class="odd">
<td align="left">findElement(using=…,value=…)</td>
<td align="left">抓取单个元素。例如：<code>remDr$findElement(using = "css", value = "#kw")。using代表定位方法："xpath", "css", "id", "name", "tag name", "class name", "link text", "partial link text"</code>; value代表要搜索的值</td>
</tr>
<tr class="even">
<td align="left"><strong>4.抓取页面元素（webElement)</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">findElements(using=…,value=…)</td>
<td align="left">抓取多个元素。</td>
</tr>
<tr class="even">
<td align="left"><strong>5.页面窗口操作</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">refresh()</td>
<td align="left">刷新页面</td>
</tr>
<tr class="even">
<td align="left">screenshot()</td>
<td align="left">截屏，如果display=FALSE,file非NULL，则将截屏保存至file指定路径</td>
</tr>
<tr class="odd">
<td align="left">goBack()</td>
<td align="left">后退到上一页</td>
</tr>
<tr class="even">
<td align="left">goForward()</td>
<td align="left">前进，与后退对应</td>
</tr>
<tr class="odd">
<td align="left">maxWindowSize()</td>
<td align="left">最大化当前窗口</td>
</tr>
<tr class="even">
<td align="left">closeWindow()</td>
<td align="left">关闭当前窗口（但session还是活跃状态）</td>
</tr>
<tr class="odd">
<td align="left">switchToWindow()</td>
<td align="left">切换窗口，参数可以输入window handle</td>
</tr>
<tr class="even">
<td align="left"><strong>6.插入JavaScript脚本来操作页面</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">executeScript()</td>
<td align="left">插入同步js，参数sript即js脚本，args如果不需要特殊设定时 = 1:2即可）。例如：页面拉到最下面的js执行方式：<code>remDr$executeScript("window.scrollTo(0,document.body.scrollHeight)", args = 1:2)</code></td>
</tr>
<tr class="even">
<td align="left">executeAsyncScipt()</td>
<td align="left">插入异步js</td>
</tr>
</tbody>
</table>
<p>webElement()函数有两种方法创建元素：</p>
<ul>
<li>直接创建: <code>webElem &lt;- webELement(elementId = "…")</code></li>
<li>抓取创建: <code>webElem &lt;- remDr$findElement(using =…, value = …)</code></li>
</ul>
<p>其常见函数如下：</p>
<table>
<colgroup>
<col width="29%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">方法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>1.获取元素信息</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">describeElement()</td>
<td align="left">获取元素描述信息</td>
</tr>
<tr class="odd">
<td align="left">getElemntText()</td>
<td align="left">获取内部文本–爬取数据的主要方法</td>
</tr>
<tr class="even">
<td align="left">getElementAttribute(attrName)</td>
<td align="left">获取元素属性–可用于爬取元素连接等。</td>
</tr>
<tr class="odd">
<td align="left">isElementDisplayed()</td>
<td align="left">元素是否被展示</td>
</tr>
<tr class="even">
<td align="left">isElementSelected()</td>
<td align="left">元素是否被选中</td>
</tr>
<tr class="odd">
<td align="left">compareElement(otherElem)</td>
<td align="left">与另一元素对比，测试是否为同一元素</td>
</tr>
<tr class="even">
<td align="left"><strong>2.发送鼠标与键盘操作</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">clearElement()</td>
<td align="left">针对文本输入框，清楚内</td>
</tr>
<tr class="even">
<td align="left">clickElement()</td>
<td align="left">单击元素</td>
</tr>
<tr class="odd">
<td align="left">highlightElement()</td>
<td align="left">高亮闪烁元素，主要用于确认定位的元素是否正确</td>
</tr>
<tr class="even">
<td align="left">sendKeysToElement()</td>
<td align="left">用法与remoteDriver函数中的sendKeysToActiveElement(sendKeys)方法相同</td>
</tr>
<tr class="odd">
<td align="left">submitElement()</td>
<td align="left">针对<code>&lt;form&gt;</code>表单，提交表单</td>
</tr>
<tr class="even">
<td align="left">setElementAttribute()</td>
<td align="left">效用函数，设定元素属性</td>
</tr>
<tr class="odd">
<td align="left"><strong>3.抓取子页面元素</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">findChildElement()</td>
<td align="left">如果当前页面元素下还有子元素，则可以用此方法抓取单个子元素，用法与remDr$findElement()相同</td>
</tr>
<tr class="odd">
<td align="left">findChildElements()</td>
<td align="left">抓取多个子元素</td>
</tr>
</tbody>
</table>
</div>
<div id="案例1在链家搜索并获取相关信息" class="section level3" number="5.9.4">
<h3><span class="header-section-number">5.9.4</span> 案例1:在链家搜索并获取相关信息</h3>
<p>本节我们将在前面的链家静态爬虫的基础上，使用RSelenium在链家官网检索“上海交通大学”，并爬取相关搜索结果。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="web.html#cb30-1"></a><span class="kw">library</span>(RSelenium)</span>
<span id="cb30-2"><a href="web.html#cb30-2"></a><span class="kw">library</span>(XML)</span>
<span id="cb30-3"><a href="web.html#cb30-3"></a><span class="kw">library</span>(RCurl)</span>
<span id="cb30-4"><a href="web.html#cb30-4"></a><span class="kw">library</span>(stringr)</span>
<span id="cb30-5"><a href="web.html#cb30-5"></a></span>
<span id="cb30-6"><a href="web.html#cb30-6"></a><span class="co"># 使用前面静态爬虫的函数</span></span>
<span id="cb30-7"><a href="web.html#cb30-7"></a>gettp &lt;-<span class="st"> </span><span class="cf">function</span>(x,j){</span>
<span id="cb30-8"><a href="web.html#cb30-8"></a>        <span class="kw">return</span>(<span class="kw">str_trim</span>(<span class="kw">unlist</span>(<span class="kw">str_split</span>(x,<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|&quot;</span>))[j]))</span>
<span id="cb30-9"><a href="web.html#cb30-9"></a>}</span>
<span id="cb30-10"><a href="web.html#cb30-10"></a><span class="co"># 设定(虚拟)浏览器</span></span>
<span id="cb30-11"><a href="web.html#cb30-11"></a>remDr &lt;-<span class="st"> </span><span class="kw">remoteDriver</span>(</span>
<span id="cb30-12"><a href="web.html#cb30-12"></a>        <span class="dt">remoteServerAddr =</span> <span class="st">&quot;localhost&quot;</span>,</span>
<span id="cb30-13"><a href="web.html#cb30-13"></a>        <span class="dt">port =</span> 4445L,</span>
<span id="cb30-14"><a href="web.html#cb30-14"></a>        <span class="dt">browserName =</span> <span class="st">&quot;firefox&quot;</span></span>
<span id="cb30-15"><a href="web.html#cb30-15"></a>)</span>
<span id="cb30-16"><a href="web.html#cb30-16"></a></span>
<span id="cb30-17"><a href="web.html#cb30-17"></a><span class="co"># 打开浏览器</span></span>
<span id="cb30-18"><a href="web.html#cb30-18"></a>remDr<span class="op">$</span><span class="kw">open</span>()</span>
<span id="cb30-19"><a href="web.html#cb30-19"></a></span>
<span id="cb30-20"><a href="web.html#cb30-20"></a><span class="co"># 打开网页</span></span>
<span id="cb30-21"><a href="web.html#cb30-21"></a>url &lt;-<span class="st"> &quot;https://sh.lianjia.com/ershoufang/&quot;</span></span>
<span id="cb30-22"><a href="web.html#cb30-22"></a>remDr<span class="op">$</span><span class="kw">navigate</span>(url)</span>
<span id="cb30-23"><a href="web.html#cb30-23"></a></span>
<span id="cb30-24"><a href="web.html#cb30-24"></a><span class="co"># 定位搜索栏目位置</span></span>
<span id="cb30-25"><a href="web.html#cb30-25"></a>xpath &lt;-<span class="st"> &#39;//input[(@id = &quot;searchInput&quot;)]&#39;</span></span>
<span id="cb30-26"><a href="web.html#cb30-26"></a>btn &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;xpath&#39;</span>, <span class="dt">value =</span> xpath)</span>
<span id="cb30-27"><a href="web.html#cb30-27"></a></span>
<span id="cb30-28"><a href="web.html#cb30-28"></a><span class="co"># 搜索交通大学</span></span>
<span id="cb30-29"><a href="web.html#cb30-29"></a>text &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;交通大学&quot;</span>, <span class="dt">key =</span> <span class="st">&#39;enter&#39;</span>)</span>
<span id="cb30-30"><a href="web.html#cb30-30"></a>btn<span class="op">$</span><span class="kw">sendKeysToElement</span>(text)</span>
<span id="cb30-31"><a href="web.html#cb30-31"></a></span>
<span id="cb30-32"><a href="web.html#cb30-32"></a><span class="co"># 查看搜索结果</span></span>
<span id="cb30-33"><a href="web.html#cb30-33"></a>remDr<span class="op">$</span><span class="kw">maxWindowSize</span>()</span>
<span id="cb30-34"><a href="web.html#cb30-34"></a>remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>)</span>
<span id="cb30-35"><a href="web.html#cb30-35"></a></span>
<span id="cb30-36"><a href="web.html#cb30-36"></a><span class="co"># 得到网页源码并解析</span></span>
<span id="cb30-37"><a href="web.html#cb30-37"></a>file &lt;-<span class="st"> </span>btn<span class="op">$</span><span class="kw">getPageSource</span>()[[<span class="dv">1</span>]]</span>
<span id="cb30-38"><a href="web.html#cb30-38"></a>parsed_doc &lt;-<span class="st"> </span><span class="kw">htmlParse</span>(file)</span>
<span id="cb30-39"><a href="web.html#cb30-39"></a></span>
<span id="cb30-40"><a href="web.html#cb30-40"></a><span class="co"># 得到相关房价信息</span></span>
<span id="cb30-41"><a href="web.html#cb30-41"></a>community &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//a[@data-el=&quot;region&quot;]&#39;</span>,xmlValue)</span>
<span id="cb30-42"><a href="web.html#cb30-42"></a>totalprice &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;totalPrice&quot;, &quot; &quot; ))]//span&#39;</span>,xmlValue)</span>
<span id="cb30-43"><a href="web.html#cb30-43"></a>type_all &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;houseInfo&quot;, &quot; &quot; ))]&#39;</span>,xmlValue)</span>
<span id="cb30-44"><a href="web.html#cb30-44"></a></span>
<span id="cb30-45"><a href="web.html#cb30-45"></a>type &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">1</span>)))</span>
<span id="cb30-46"><a href="web.html#cb30-46"></a>size &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">2</span>)))</span>
<span id="cb30-47"><a href="web.html#cb30-47"></a>year &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">6</span>)))</span>
<span id="cb30-48"><a href="web.html#cb30-48"></a>avgprice &lt;-<span class="st">  </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;unitPrice&quot;, &quot; &quot; ))]//span&#39;</span>,xmlValue)</span>
<span id="cb30-49"><a href="web.html#cb30-49"></a>result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(community,totalprice,type,size,year,avgprice)</span>
<span id="cb30-50"><a href="web.html#cb30-50"></a></span>
<span id="cb30-51"><a href="web.html#cb30-51"></a><span class="co"># 点击2页</span></span>
<span id="cb30-52"><a href="web.html#cb30-52"></a>pg &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&quot;xpath&quot;</span>,<span class="dt">value =</span> <span class="st">&quot;//a[@data-page=&#39;2&#39;]&quot;</span>)</span>
<span id="cb30-53"><a href="web.html#cb30-53"></a>pg<span class="op">$</span><span class="kw">clickElement</span>()</span>
<span id="cb30-54"><a href="web.html#cb30-54"></a>remDr<span class="op">$</span><span class="kw">getCurrentUrl</span>()</span>
<span id="cb30-55"><a href="web.html#cb30-55"></a></span>
<span id="cb30-56"><a href="web.html#cb30-56"></a><span class="co"># 重复上述操作，但是在这之前我们需要知道总共有多少页需要爬</span></span>
<span id="cb30-57"><a href="web.html#cb30-57"></a>page &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_extract</span>(<span class="kw">xpathSApply</span>(parsed_doc,</span>
<span id="cb30-58"><a href="web.html#cb30-58"></a>                                <span class="st">&#39;/html/body/div[4]/div[1]/div[8]/div[2]/div&#39;</span>,</span>
<span id="cb30-59"><a href="web.html#cb30-59"></a>                                xmlGetAttr,<span class="st">&quot;page-data&quot;</span>),</span>
<span id="cb30-60"><a href="web.html#cb30-60"></a>                    <span class="dt">pattern =</span> <span class="st">&quot;[0-9]+&quot;</span>))</span>
<span id="cb30-61"><a href="web.html#cb30-61"></a></span>
<span id="cb30-62"><a href="web.html#cb30-62"></a><span class="co"># 在这个基础上跑循环</span></span>
<span id="cb30-63"><a href="web.html#cb30-63"></a>house &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb30-64"><a href="web.html#cb30-64"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>page){</span>
<span id="cb30-65"><a href="web.html#cb30-65"></a>        pg &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&quot;xpath&quot;</span>,<span class="dt">value =</span> <span class="kw">paste0</span>(<span class="st">&quot;//a[@data-page=&quot;</span>,<span class="st">&quot;&#39;&quot;</span>,i,<span class="st">&quot;&#39;]&quot;</span>))</span>
<span id="cb30-66"><a href="web.html#cb30-66"></a>        pg<span class="op">$</span><span class="kw">clickElement</span>()</span>
<span id="cb30-67"><a href="web.html#cb30-67"></a>        <span class="co"># 得到网页源码并解析</span></span>
<span id="cb30-68"><a href="web.html#cb30-68"></a>        file &lt;-<span class="st"> </span>btn<span class="op">$</span><span class="kw">getPageSource</span>()[[<span class="dv">1</span>]]</span>
<span id="cb30-69"><a href="web.html#cb30-69"></a>        parsed_doc &lt;-<span class="st"> </span><span class="kw">htmlParse</span>(file)</span>
<span id="cb30-70"><a href="web.html#cb30-70"></a>        <span class="co"># 得到相关房价信息</span></span>
<span id="cb30-71"><a href="web.html#cb30-71"></a>        community &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//a[@data-el=&quot;region&quot;]&#39;</span>,xmlValue)</span>
<span id="cb30-72"><a href="web.html#cb30-72"></a>        totalprice &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;totalPrice&quot;, &quot; &quot; ))]//span&#39;</span>,xmlValue)</span>
<span id="cb30-73"><a href="web.html#cb30-73"></a>        type_all &lt;-<span class="st"> </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;houseInfo&quot;, &quot; &quot; ))]&#39;</span>,xmlValue)</span>
<span id="cb30-74"><a href="web.html#cb30-74"></a>        type &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">1</span>)))</span>
<span id="cb30-75"><a href="web.html#cb30-75"></a>        size &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">2</span>)))</span>
<span id="cb30-76"><a href="web.html#cb30-76"></a>        year &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(type_all,<span class="cf">function</span>(x) <span class="kw">gettp</span>(x,<span class="dv">6</span>)))</span>
<span id="cb30-77"><a href="web.html#cb30-77"></a>        avgprice &lt;-<span class="st">  </span><span class="kw">xpathSApply</span>(parsed_doc, <span class="st">&#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;unitPrice&quot;, &quot; &quot; ))]//span&#39;</span>,xmlValue)</span>
<span id="cb30-78"><a href="web.html#cb30-78"></a>        result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(community,totalprice,type,size,year,avgprice)</span>
<span id="cb30-79"><a href="web.html#cb30-79"></a>        <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb30-80"><a href="web.html#cb30-80"></a>        house &lt;-<span class="st"> </span><span class="kw">rbind</span>(house,result)</span>
<span id="cb30-81"><a href="web.html#cb30-81"></a>        <span class="kw">cat</span>(<span class="st">&quot;第&quot;</span>,i,<span class="st">&quot;页爬成功&quot;</span>,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb30-82"><a href="web.html#cb30-82"></a>}</span></code></pre></div>
</div>
<div id="案例2登录豆瓣" class="section level3" number="5.9.5">
<h3><span class="header-section-number">5.9.5</span> 案例2:登录豆瓣</h3>
<p>本节我们将使用RSelenium模拟登录豆瓣账号。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="web.html#cb31-1"></a><span class="kw">library</span>(RSelenium)</span>
<span id="cb31-2"><a href="web.html#cb31-2"></a><span class="kw">library</span>(XML)</span>
<span id="cb31-3"><a href="web.html#cb31-3"></a><span class="kw">library</span>(RCurl)</span>
<span id="cb31-4"><a href="web.html#cb31-4"></a></span>
<span id="cb31-5"><a href="web.html#cb31-5"></a><span class="co"># 设定(虚拟)浏览器</span></span>
<span id="cb31-6"><a href="web.html#cb31-6"></a>remDr &lt;-<span class="st"> </span><span class="kw">remoteDriver</span>(</span>
<span id="cb31-7"><a href="web.html#cb31-7"></a>        <span class="dt">remoteServerAddr =</span> <span class="st">&quot;localhost&quot;</span>,</span>
<span id="cb31-8"><a href="web.html#cb31-8"></a>        <span class="dt">port =</span> 4445L,</span>
<span id="cb31-9"><a href="web.html#cb31-9"></a>        <span class="dt">browserName =</span> <span class="st">&quot;firefox&quot;</span></span>
<span id="cb31-10"><a href="web.html#cb31-10"></a>)</span>
<span id="cb31-11"><a href="web.html#cb31-11"></a><span class="co"># 打开浏览器</span></span>
<span id="cb31-12"><a href="web.html#cb31-12"></a>remDr<span class="op">$</span><span class="kw">open</span>()</span>
<span id="cb31-13"><a href="web.html#cb31-13"></a><span class="co"># 打开豆瓣登录页</span></span>
<span id="cb31-14"><a href="web.html#cb31-14"></a>url &lt;-<span class="st"> &quot;https://accounts.douban.com/passport/login?&quot;</span></span>
<span id="cb31-15"><a href="web.html#cb31-15"></a>remDr<span class="op">$</span><span class="kw">navigate</span>(url)</span>
<span id="cb31-16"><a href="web.html#cb31-16"></a>remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>) <span class="co">#由于浏览器是在Docker中虚拟的，因此需要使用截图来查看当前的显示页面</span></span>
<span id="cb31-17"><a href="web.html#cb31-17"></a></span>
<span id="cb31-18"><a href="web.html#cb31-18"></a><span class="co"># 定位登录选项的位置</span></span>
<span id="cb31-19"><a href="web.html#cb31-19"></a>xpath &lt;-<span class="st"> &#39;/html/body/div[1]/div[2]/div[2]/div/div[1]/ul[1]/li[2]&#39;</span></span>
<span id="cb31-20"><a href="web.html#cb31-20"></a>btn &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;xpath&#39;</span>, <span class="dt">value =</span> xpath)</span>
<span id="cb31-21"><a href="web.html#cb31-21"></a></span>
<span id="cb31-22"><a href="web.html#cb31-22"></a><span class="co"># 点击切换成邮箱密码登录</span></span>
<span id="cb31-23"><a href="web.html#cb31-23"></a>btn<span class="op">$</span><span class="kw">clickElement</span>()</span>
<span id="cb31-24"><a href="web.html#cb31-24"></a>remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>) <span class="co"># 此时已经切换成为邮箱密码登录</span></span>
<span id="cb31-25"><a href="web.html#cb31-25"></a></span>
<span id="cb31-26"><a href="web.html#cb31-26"></a><span class="co"># 找到用户名和密码栏，分别输入</span></span>
<span id="cb31-27"><a href="web.html#cb31-27"></a>un &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;xpath&#39;</span>,<span class="dt">value =</span><span class="st">&#39;//*[@id=&quot;username&quot;]&#39;</span>)</span>
<span id="cb31-28"><a href="web.html#cb31-28"></a>un<span class="op">$</span><span class="kw">sendKeysToElement</span>(<span class="kw">list</span>(<span class="st">&quot;dataengineering@sjtu.edu.cn&quot;</span>))</span>
<span id="cb31-29"><a href="web.html#cb31-29"></a></span>
<span id="cb31-30"><a href="web.html#cb31-30"></a>pw &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;xpath&#39;</span>,<span class="dt">value =</span><span class="st">&#39;//*[@id=&quot;password&quot;]&#39;</span>)</span>
<span id="cb31-31"><a href="web.html#cb31-31"></a>pw<span class="op">$</span><span class="kw">sendKeysToElement</span>(<span class="kw">list</span>(<span class="st">&quot;ec@nomistno1&quot;</span>))</span>
<span id="cb31-32"><a href="web.html#cb31-32"></a>remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>) <span class="co"># 可以看到已经输入相关信息</span></span>
<span id="cb31-33"><a href="web.html#cb31-33"></a></span>
<span id="cb31-34"><a href="web.html#cb31-34"></a><span class="co"># 找到登录键，并点击登录</span></span>
<span id="cb31-35"><a href="web.html#cb31-35"></a>loginbtn &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;xpath&#39;</span>,<span class="dt">value =</span><span class="st">&#39;/html/body/div[1]/div[2]/div[2]/div/div[2]/div[1]/div[4]/a&#39;</span>)</span>
<span id="cb31-36"><a href="web.html#cb31-36"></a>loginbtn<span class="op">$</span><span class="kw">clickElement</span>()</span>
<span id="cb31-37"><a href="web.html#cb31-37"></a>remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>写一个教材，实在是太难了</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p><a href="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/First_steps/A_first_splash" class="uri">https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/First_steps/A_first_splash</a><a href="web.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="https://docs.docker.com/desktop/" class="uri">https://docs.docker.com/desktop/</a><a href="web.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rw.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="md.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-chinese/edit/master/04-web.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
